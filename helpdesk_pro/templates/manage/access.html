{% extends "base.html" %}
{% block content %}

<style>
  .access-table th,
  .access-table td {
    vertical-align: middle;
  }
  .access-role-header {
    text-transform: uppercase;
    font-size: 0.8rem;
    letter-spacing: 0.06em;
  }
  .menu-label {
    font-weight: 600;
  }
  .menu-group {
    background: rgba(13, 110, 253, 0.08);
  }
  html[data-bs-theme="dark"] body .menu-group {
    background: rgba(15, 23, 42, 0.6);
  }
</style>

<div class="d-flex justify-content-between align-items-center mb-3">
  <h4 class="mb-0"><i class="fa fa-key"></i> {{ _('Access Control') }}</h4>
  <a href="{{ url_for('users.list_users') }}?lang={{ g.locale }}" class="btn btn-outline-secondary">
    <i class="fa fa-users"></i> {{ _('Manage Users') }}
  </a>
</div>

<div class="alert alert-info shadow-sm">
  <i class="fa fa-info-circle"></i>
  {{ _('Toggle which roles can see each menu item. Defaults apply when no override is set.') }}
</div>

<form method="post">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
  <input type="hidden" name="form_type" value="menu">
  <div class="card shadow-sm">
    <div class="card-header">
      <strong>{{ _('Menu Permissions') }}</strong>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-striped mb-0 access-table">
          <thead class="table-dark">
            <tr>
              <th>{{ _('Menu Item') }}</th>
              {% for role in roles %}
                <th class="text-center access-role-header">{{ role|capitalize }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for item in menu_items %}
              <tr class="{% if item.has_children %}menu-group{% endif %}">
                <td class="menu-label">
                  {% if item.has_children %}<i class="fa fa-folder-open text-primary"></i>{% else %}<i class="fa fa-circle text-muted"></i>{% endif %}
                  {{ _(item.label) }}
                </td>
                {% for role in item.roles %}
                  <td class="text-center">
                    <div class="form-check d-inline-flex justify-content-center">
                      <input class="form-check-input" type="checkbox" name="perm_{{ item.key }}_{{ role.role }}" id="perm_{{ item.key }}_{{ role.role }}" {% if role.current %}checked{% endif %}>
                    </div>
                  </td>
                {% endfor %}
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <div class="card-footer text-end">
      <button type="submit" class="btn btn-primary"><i class="fa fa-save me-1"></i>{{ _('Save Changes') }}</button>
    </div>
  </div>
</form>

<div class="alert alert-warning shadow-sm mt-4">
  <i class="fa fa-shield-alt"></i>
  {{ _('Define read or read/write permissions for sensitive modules. Admins always retain full access.') }}
</div>

<form method="post">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
  <input type="hidden" name="form_type" value="module">
  <div class="card shadow-sm">
    <div class="card-header">
      <strong>{{ _('Module Permissions') }}</strong>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-striped mb-0 access-table">
          <thead class="table-dark">
            <tr>
              <th>{{ _('Module') }}</th>
              {% for role in roles %}
                <th class="text-center access-role-header">{{ role|capitalize }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for module in module_items %}
              <tr>
                <td class="menu-label">
                  <i class="fa fa-cube text-primary opacity-75"></i> {{ _(module.label) }}
                </td>
                {% for role in module.roles %}
                  <td class="text-center">
                    <div class="btn-group btn-group-sm" role="group" aria-label="{{ role.role }} {{ module.key }} access">
                      <input type="radio"
                             class="btn-check"
                             name="module_perm_{{ module.key }}_{{ role.role }}"
                             id="module_perm_{{ module.key }}_{{ role.role }}_read"
                             value="read"
                             {% if role.current == 'read' %}checked{% endif %}>
                      <label class="btn btn-outline-secondary" for="module_perm_{{ module.key }}_{{ role.role }}_read">{{ _('Read') }}</label>

                      <input type="radio"
                             class="btn-check"
                             name="module_perm_{{ module.key }}_{{ role.role }}"
                             id="module_perm_{{ module.key }}_{{ role.role }}_write"
                             value="write"
                             {% if role.current != 'read' %}checked{% endif %}>
                      <label class="btn btn-outline-secondary" for="module_perm_{{ module.key }}_{{ role.role }}_write">{{ _('Read / Write') }}</label>
                    </div>
                  </td>
                {% endfor %}
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <div class="card-footer text-end">
      <button type="submit" class="btn btn-primary"><i class="fa fa-save me-1"></i>{{ _('Save Changes') }}</button>
    </div>
  </div>
</form>

{% endblock %}
