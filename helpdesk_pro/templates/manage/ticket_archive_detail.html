{% extends "base.html" %}
{% block content %}
<style>
  .ticket-pulse {
    border: none;
    border-radius: 1.1rem;
    background: linear-gradient(135deg, rgba(15,23,42,0.04), rgba(99,102,241,0.08));
  }
  .ticket-pulse .card-body {
    padding: 2rem;
  }
  .ticket-meta-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
    gap: 1rem;
  }
  .ticket-meta-item {
    background: rgba(15,23,42,0.04);
    border-radius: 0.75rem;
    padding: 1rem;
  }
  html[data-bs-theme="dark"] .ticket-meta-item {
    background: rgba(255,255,255,0.06);
  }
  .timeline-pill {
    border-left: 3px solid #6366f1;
    padding-left: 0.75rem;
  }
  .timeline-pill i {
    width: 1.25rem;
    text-align: center;
    color: #6366f1;
  }
  .list-gradient .list-group-item {
    border: none;
    border-radius: 0.75rem;
    margin-bottom: 0.5rem;
    background: rgba(15,23,42,0.03);
  }
  html[data-bs-theme="dark"] .list-gradient .list-group-item {
    background: rgba(255,255,255,0.05);
  }
  pre {
    background: rgba(248,249,250,0.85);
    color: #0f172a;
  }
  .description-text {
    white-space: pre-wrap;
    line-height: 1.6;
    color: inherit;
    background: transparent;
  }
  html[data-bs-theme="dark"] pre {
    background: rgba(15,23,42,0.65);
    color: #f8fafc;
  }
  html[data-bs-theme="dark"] .ticket-pulse {
    background: linear-gradient(135deg, rgba(59,130,246,0.12), rgba(99,102,241,0.24));
  }
  html[data-bs-theme="dark"] .card-header.bg-white {
    background-color: rgba(15,23,42,0.8) !important;
    color: #f8fafc;
  }
</style>

<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
  <div>
    <h1 class="h4 mb-1"><i class="fa fa-file-circle-info text-secondary me-2"></i>{{ _('Archived Ticket #%(id)s', id=archive.ticket_id) }}</h1>
    <div class="small text-muted">
      <i class="fa fa-box-archive me-1"></i>{{ _('Archived at %(time)s', time=archive.archived_at.strftime('%Y-%m-%d %H:%M') if archive.archived_at else _('Unknown')) }}
    </div>
  </div>
  <a class="btn btn-outline-secondary" href="{{ url_for('manage.ticket_archives') }}"><i class="fa fa-arrow-left me-1"></i>{{ _('Back to list') }}</a>
</div>

<div class="card ticket-pulse shadow-sm mb-4">
  <div class="card-body">
    <div class="d-flex flex-wrap gap-2 align-items-center mb-3">
      {% if owner_name %}
        <span class="badge bg-primary-subtle text-primary-emphasis"><i class="fa fa-user me-1"></i>{{ _('Owner') }}: {{ owner_name }}</span>
      {% else %}
        <span class="badge bg-primary-subtle text-primary-emphasis"><i class="fa fa-user me-1"></i>{{ _('Owner') }}: {{ _('Unknown') }}</span>
      {% endif %}
      <span class="badge bg-info-subtle text-info-emphasis"><i class="fa fa-building me-1"></i>{{ archive.department or _('—') }}</span>
      <span class="badge bg-secondary-subtle text-secondary-emphasis"><i class="fa fa-signal me-1"></i>{{ archive.priority or _('—') }}</span>
      <span class="badge bg-success-subtle text-success-emphasis"><i class="fa fa-info-circle me-1"></i>{{ archive.status or _('—') }}</span>
    </div>
    <div class="ticket-meta-grid mb-4">
      <div class="ticket-meta-item">
        <div class="text-muted small mb-1"><i class="fa fa-heading me-1"></i>{{ _('Subject') }}</div>
        <div class="fw-semibold">{{ archive.subject }}</div>
      </div>
      <div class="ticket-meta-item">
        <div class="text-muted small mb-1"><i class="fa fa-calendar-plus me-1"></i>{{ _('Created At') }}</div>
        <div>{{ archive.created_at.strftime('%Y-%m-%d %H:%M') if archive.created_at else '—' }}</div>
      </div>
      <div class="ticket-meta-item">
        <div class="text-muted small mb-1"><i class="fa fa-calendar-check me-1"></i>{{ _('Closed At') }}</div>
        <div>{{ archive.closed_at.strftime('%Y-%m-%d %H:%M') if archive.closed_at else '—' }}</div>
      </div>
    </div>
    <div class="ticket-meta-item description-container mt-3">
      <p class="fw-semibold mb-1"><i class="fa fa-align-left me-1 text-primary"></i>{{ _('Description') }}</p>
      <div class="description-text">{{ archive.description }}</div>
    </div>
  </div>
</div>

<div class="row g-3">
  <div class="col-lg-6">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-white">
        <h2 class="h6 mb-0"><i class="fa fa-comments me-1 text-primary"></i>{{ _('Comments') }}</h2>
      </div>
      <div class="card-body">
        {% if archive.comments %}
          <div class="list-group list-gradient">
            {% for comment in archive.comments %}
              <div class="list-group-item">
                <div class="d-flex justify-content-between align-items-center">
                  <strong><i class="fa fa-user text-primary me-1"></i>{{ comment.user or _('Anonymous') }}</strong>
                  <small class="text-muted"><i class="fa fa-clock me-1"></i>{{ comment.created_at or '' }}</small>
                </div>
                <p class="mb-0 mt-2 small">{{ comment.comment }}</p>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted mb-0">{{ _('No comments were captured for this ticket.') }}</p>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-lg-6">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-white">
        <h2 class="h6 mb-0"><i class="fa fa-paperclip me-1"></i>{{ _('Attachments') }}</h2>
      </div>
      <div class="card-body">
        {% if archive.attachments %}
          <ul class="list-group list-gradient">
            {% for attachment in archive.attachments %}
              <li class="list-group-item">
                <div class="d-flex justify-content-between align-items-center">
                  <span><i class="fa fa-file text-primary me-1"></i>{{ attachment.filename }}</span>
                  <span class="small text-muted">{{ attachment.filepath }}</span>
                </div>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted mb-0">{{ _('No attachments were indexed for this ticket.') }}</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="card shadow-sm mt-3">
  <div class="card-header bg-white">
    <h2 class="h6 mb-0"><i class="fa fa-clock-rotate-left me-1"></i>{{ _('Audit Log Snapshot') }}</h2>
  </div>
  <div class="card-body">
    {% if archive.logs %}
      <ul class="list-group list-gradient mb-0">
        {% for log in archive.logs %}
          <li class="list-group-item">
            <div class="d-flex justify-content-between align-items-center">
              <span><i class="fa fa-user-gear text-secondary me-1"></i>{{ log.username or _('System') }} </span>
              <small class="text-muted"><i class="fa fa-clock me-1"></i>{{ log.timestamp or '' }}</small>
            </div>
            <div class="small text-muted mt-1">{{ log.action }}</div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-muted mb-0">{{ _('No audit log entries were stored.') }}</p>
    {% endif %}
  </div>
</div>
{% endblock %}
