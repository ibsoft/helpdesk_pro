<div class="modal fade" id="editJobModal{{ job.id }}" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <form class="modal-content" method="post" action="{{ url_for('fleet.edit_scheduled_job', job_id=job.id) }}">
      <div class="modal-header modal-header-gradient text-white">
        <h5 class="modal-title"><i class="fa fa-pen me-2"></i>{{ _('Edit job') }}</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="row g-3">
          <div class="col-12">
            <label class="form-label">{{ _('Job name') }}</label>
            <input type="text" class="form-control" name="job_name" value="{{ job.name }}">
          </div>
          <div class="col-md-6">
            <label class="form-label">{{ _('Run at (local time)') }}</label>
            <input type="datetime-local" class="form-control" name="job_run_at" value="{{ job_forms[loop.index0].run_at }}">
          </div>
          <div class="col-md-6">
            <label class="form-label">{{ _('Recurrence') }}</label>
            <select class="form-select" name="job_recurrence">
              {% set current_recurrence = job_forms[loop.index0].recurrence %}
              <option value="once" {% if current_recurrence == 'once' %}selected{% endif %}>{{ _('Once') }}</option>
              <option value="daily" {% if current_recurrence == 'daily' %}selected{% endif %}>{{ _('Daily') }}</option>
              <option value="weekly" {% if current_recurrence == 'weekly' %}selected{% endif %}>{{ _('Weekly') }}</option>
            </select>
          </div>
          {% if job.action_type == 'command' %}
            <div class="col-12">
              <label class="form-label">{{ _('PowerShell script') }}</label>
              <textarea class="form-control font-monospace" rows="6" name="job_command_script">{{ job_forms[loop.index0].script }}</textarea>
            </div>
          {% else %}
            <div class="col-12">
              <div class="alert alert-info mb-0">
                <i class="fa fa-file-arrow-up me-2"></i>{{ _('Upload jobs cannot change files after creation.') }}
              </div>
            </div>
          {% endif %}
          <div class="col-12">
            <label class="form-label">{{ _('Notes') }}</label>
            <textarea class="form-control" rows="2" name="job_notes">{{ job_forms[loop.index0].notes or '' }}</textarea>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">{{ _('Close') }}</button>
        <button class="btn btn-primary"><i class="fa fa-save me-1"></i>{{ _('Save changes') }}</button>
      </div>
    </form>
  </div>
</div>
<div class="modal fade" id="deleteJobModal{{ job.id }}" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form class="modal-content" method="post" action="{{ url_for('fleet.delete_scheduled_job', job_id=job.id) }}">
      <div class="modal-header modal-header-gradient text-white">
        <h5 class="modal-title"><i class="fa fa-trash me-2"></i>{{ _('Delete job') }}</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <p class="mb-0">{{ _('Are you sure you want to delete \"%(name)s\"? This cannot be undone.', name=job.name) }}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">{{ _('Cancel') }}</button>
        <button class="btn btn-danger"><i class="fa fa-trash me-1"></i>{{ _('Delete job') }}</button>
      </div>
    </form>
  </div>
</div>
<div class="modal fade" id="rescheduleJobModal{{ job.id }}" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form class="modal-content" method="post" action="{{ url_for('fleet.reschedule_scheduled_job', job_id=job.id) }}">
      <div class="modal-header modal-header-gradient text-white">
        <h5 class="modal-title"><i class="fa fa-rotate me-2"></i>{{ _('Reschedule job') }}</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <label class="form-label">{{ _('New run time') }}</label>
        <input type="datetime-local" class="form-control" name="job_run_at" value="{{ job_forms[loop.index0].run_at }}">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">{{ _('Cancel') }}</button>
        <button class="btn btn-success"><i class="fa fa-rotate me-1"></i>{{ _('Reschedule') }}</button>
      </div>
    </form>
  </div>
</div>
