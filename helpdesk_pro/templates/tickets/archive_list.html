{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
  <h4 class="mb-0"><i class="fa fa-box-archive me-2"></i>{{ _('Archived Tickets') }}</h4>
  <div class="d-flex flex-wrap gap-2">
    <a class="btn btn-outline-secondary" href="{{ url_for('tickets.list_tickets') }}">
      <i class="fa fa-ticket me-1"></i>{{ _('Back to Tickets') }}
    </a>
  </div>
</div>

<div class="card shadow-sm">
  <div class="card-body">
    {% if archives %}
      <table id="archiveTable" class="table table-striped table-hover align-middle w-100">
        <thead class="table-dark">
          <tr>
            <th>{{ _('Ticket #') }}</th>
            <th>{{ _('Subject') }}</th>
            <th>{{ _('Priority') }}</th>
            <th>{{ _('Status') }}</th>
            <th>{{ _('Archived At') }}</th>
            <th>{{ _('Actions') }}</th>
          </tr>
        </thead>
        <tbody>
          {% for archive in archives %}
            <tr data-archive-id="{{ archive.id }}">
              <td>{{ archive.ticket_id }}</td>
              <td>{{ archive.subject }}</td>
              <td>{{ archive.priority or _('—') }}</td>
              <td>{{ archive.status or _('—') }}</td>
              <td data-order="{{ archive.archived_at.isoformat() if archive.archived_at else '' }}">
                {{ archive.archived_at.strftime('%Y-%m-%d %H:%M') if archive.archived_at else '—' }}
              </td>
              <td class="text-nowrap">
                <a class="btn btn-sm btn-outline-info" href="{{ url_for('tickets.view_ticket_archive', archive_id=archive.id) }}">
                  <i class="fa fa-eye"></i> {{ _('View') }}
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted mb-0">{{ _('No archived tickets yet.') }}</p>
    {% endif %}
  </div>
</div>

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>
<script src="https://cdn.datatables.net/searchbuilder/1.7.0/js/dataTables.searchBuilder.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/searchbuilder/1.7.0/css/searchBuilder.bootstrap5.min.css">

<script>
$(function() {
  $('#archiveTable').DataTable({
    order: [[4, 'desc']],
    pageLength: 10,
    language: { url: "{{ url_for('static', filename='datatables/' + g.locale + '.json') }}" },
    dom: "<'row mb-2'<'col-md-6 d-flex align-items-center gap-2'lB><'col-md-6 text-end'f>>" +
         "<'row'<'col-sm-12'tr>>" +
         "<'row mt-3'<'col-12'Q>>" +
         "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
    buttons: [
      { extend: 'excelHtml5', text: '<i class=\"fa fa-file-excel\"></i> {{ _("Excel") }}', className: 'btn btn-success btn-sm mx-1' },
      { extend: 'print', text: '<i class=\"fa fa-print\"></i> {{ _("Print") }}', className: 'btn btn-secondary btn-sm mx-1' },
      { extend: 'searchBuilder', text: '<i class=\"fa fa-filter\"></i> {{ _("Advanced Filters") }}', className: 'btn btn-secondary btn-sm mx-1' }
    ],
    searchBuilder: {
      columns: [0,1,2,3,4],
      depthLimit: 3
    }
  });
});
</script>
{% endblock %}
